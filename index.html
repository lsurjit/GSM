<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Temperature & Humidity Data</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: center;
        }
        button {
            padding: 10px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>Temperature & Humidity Data Records</h1>
    
    <table id="dataTable">
        <thead>
            <tr>
                <th>Time</th>
                <th>Temperature (°C)</th>
                <th>Humidity (%)</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data rows will be added here -->
        </tbody>
    </table>

    <button onclick="addData()">Add Data</button>
    <button onclick="resetData()">Reset Data</button>
    <button onclick="downloadData()">Download Excel</button>

    <h3>Send Data Link</h3>
    <a href="#" id="gsmLink" target="_blank">Send Data via GSM</a>

    <script>
        // Sample data
        const data = [
            { time: '2024-12-08 10:00', temperature: 24.5, humidity: 60 },
            { time: '2024-12-08 10:30', temperature: 25.0, humidity: 58 },
        ];

        // Function to add a row to the table
        function addData() {
            const now = new Date();
            const time = now.toISOString().slice(0, 19).replace("T", " ");
            const temperature = (Math.random();  // Random temperature between 20 and 30
            const humidity = (Math.random();      // Random humidity between 40 and 80

            const table = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            newRow.insertCell(0).textContent = time;
            newRow.insertCell(1).textContent = temperature;
            newRow.insertCell(2).textContent = humidity;

            // Update GSM Link
            const gsmLink = document.getElementById('gsmLink');
            gsmLink.href = `https://lsurjit.github.io/GSM?time=${time}&temperature=${temperature}&humidity=${humidity}`;
        }

        // Function to reset the data table
        function resetData() {
            const table = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
            table.innerHTML = ''; // Clear all rows
        }

        // Function to download the data as an Excel file
        function downloadData() {
            let tableData = [["Time", "Temperature (°C)", "Humidity (%)"]];
            const rows = document.getElementById('dataTable').getElementsByTagName('tbody')[0].rows;

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const rowData = [
                    row.cells[0].textContent,
                    row.cells[1].textContent,
                    row.cells[2].textContent
                ];
                tableData.push(rowData);
            }

            const workbook = XLSX.utils.book_new();
            const worksheet = XLSX.utils.aoa_to_sheet(tableData);
            XLSX.utils.book_append_sheet(workbook, worksheet, "Data");

            // Download the Excel file
            XLSX.writeFile(workbook, "temperature_humidity_data.xlsx");
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>
</body>
</html>
